name: Merge prd to main

on:
  push:
    branches:
      - "prd"
  workflow_dispatch:

env:
  user_name: ${{ vars.GIT_USER_NAME }}
  user_email: ${{ vars.GIT_USER_EMAIL }}

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Print Payload
        run: cat $GITHUB_EVENT_PATH
      - uses: actions/checkout@v3
        with:
          ref: prd
          fetch-depth: 0
      - name: Git commit
        run: |
          git config user.name $user_name
          git config user.email $user_email

          set +e
          git fetch
          git switch main
          git diff main..prd -- changelog.json â€“exit-code
          if [ $? -eq 0 ]; then
            git merge prd
            git push origin main
          fi
          set -e
